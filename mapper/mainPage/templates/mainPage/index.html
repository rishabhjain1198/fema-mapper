
<!DOCTYPE html>
<html>
<head>

	<meta charset="utf-8" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>
    <script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>


	<style>
		html, body {
			height: 100%;
			margin: 0;
		}
		#map {
			width: 600px;
			height: 400px;
		}
	</style>

	<style>#map { width: 800px; height: 500px; }
.info { padding: 6px 8px; font: 14px/16px Arial, Helvetica, sans-serif; background: white; background: rgba(255,255,255,0.8); box-shadow: 0 0 15px rgba(0,0,0,0.2); border-radius: 5px; } .info h4 { margin: 0 0 5px; color: #777; }
.legend { text-align: left; line-height: 18px; color: #555; } .legend i { width: 18px; height: 18px; float: left; margin-right: 8px; opacity: 0.7; }</style>
</head>
<body>




  <div id="demo" style="margin-left:15px; margin-bottom:10px; margin-top:10px">
    Disasters upto and including this year will be shown
  </div>
  <div style="margin-left:40px;">
		<select name="end-year" id="end-year">
			<option value="2018">2018</option>
			<option value="2017">2017</option>
			<option value="2016">2016</option>
			<option value="2015">2015</option>
			<option value="2014">2014</option>
    <option value="2013">2013</option>
    <option value="2012">2012</option>
    <option value="2011">2011</option>
    <option value="2010">2010</option>
    <option value="2009">2009</option>
    <option value="2008">2008</option>
    <option value="2007">2007</option>
    <option value="2006">2006</option>
    <option value="2005">2005</option>
    <option value="2004">2004</option>
    <option value="2003">2003</option>
    <option value="2002">2002</option>
    <option value="2001">2001</option>
    <option value="2000">2000</option>
    <option value="1999">1999</option>
    <option value="1998">1998</option>
    <option value="1997">1997</option>
    <option value="1996">1996</option>
    <option value="1995">1995</option>
    <option value="1994">1994</option>
    <option value="1993">1993</option>
    <option value="1992">1992</option>
    <option value="1991">1991</option>
    <option value="1990">1990</option>
    <option value="1989">1989</option>
    <option value="1988">1988</option>
    <option value="1987">1987</option>
    <option value="1986">1986</option>
    <option value="1985">1985</option>
    <option value="1984">1984</option>
    <option value="1983">1983</option>
    <option value="1982">1982</option>
    <option value="1981">1981</option>
    <option value="1980">1980</option>
    <option value="1979">1979</option>
    <option value="1978">1978</option>
    <option value="1977">1977</option>
    <option value="1976">1976</option>
    <option value="1975">1975</option>
    <option value="1974">1974</option>
    <option value="1973">1973</option>
    <option value="1972">1972</option>
    <option value="1971">1971</option>
    <option value="1970">1970</option>
    <option value="1969">1969</option>
    <option value="1968">1968</option>
    <option value="1967">1967</option>
    <option value="1966">1966</option>
    <option value="1965">1965</option>
    <option value="1964">1964</option>
    <option value="1963">1963</option>
    <option value="1962">1962</option>
    <option value="1961">1961</option>
    <option value="1960">1960</option>
    <option value="1959">1959</option>
    <option value="1958">1958</option>
    <option value="1957">1957</option>
    <option value="1956">1956</option>
    <option value="1955">1955</option>
    <option value="1954">1954</option>
    <option value="1953">1953</option>
	</select>
  </div>

  <div style="margin:20px">
    <div>
      <input value="Human_Cause" type="checkbox" name="boxes" onchange="checkbox()">	Human Cause
</div>
<div>
      <input value="Volcano" type="checkbox" name="boxes" onchange="checkbox()">	Volcano
</div>
      <input value="Drought" type="checkbox" name="boxes" onchange="checkbox()">	Drought

<div>
			<input value="Toxic_Substances" type="checkbox" name="boxes" onchange="checkbox()">	Toxic Substances
	</div>

	<div>
				<input value="Tornado" type="checkbox" name="boxes" onchange="checkbox()">	Tornado
		</div>
		<div>
					<input value="Hurricane" type="checkbox" name="boxes" onchange="checkbox()">	Hurricane
			</div>
			<div>
						<input value="Chemical" type="checkbox" name="boxes" onchange="checkbox()">	Chemical
				</div>
				<div>
							<input value="Earthquake" type="checkbox" name="boxes" onchange="checkbox()">	Earthquake
					</div>
	<div>
				<input value="Freezing" type="checkbox" name="boxes" onchange="checkbox()">	Freezing
	</div>
	<div>
				<input value="Tsunami" type="checkbox" name="boxes" onchange="checkbox()">	Tsunami
	</div>
	<div>
				<input value="Other" type="checkbox" name="boxes" onchange="checkbox()">	Other
	</div>
	<div>
				<input value="Severe_Ice_Storm" type="checkbox" name="boxes" onchange="checkbox()">	Severe Ice Storm
	</div>
	<div>
				<input value="Coastal_Storm" type="checkbox" name="boxes" onchange="checkbox()">	Coastal Storm
	</div>
	<div>
				<input value="Fishing_Losses" type="checkbox" name="boxes" onchange="checkbox()">	Fishing Losses
	</div>
	<div>
				<input value="Snow" type="checkbox" name="boxes" onchange="checkbox()">	Snow
	</div>
	<div>
				<input value="Fire" type="checkbox" name="boxes" onchange="checkbox()">	Fire
	</div>
	<div>
				<input value="Severe_Storm(s)" type="checkbox" name="boxes" onchange="checkbox()">	Severe Storm(s)
	</div>
	<div>
				<input value="Typhoon" type="checkbox" name="boxes" onchange="checkbox()">	Typhoon
	</div>
	<div>
				<input value="Terrorist" type="checkbox" name="boxes" onchange="checkbox()">	Terrorist
	</div>
	<div>
				<input value="Flood" type="checkbox" name="boxes" onchange="checkbox()">	Flood
	</div>
	<div>
				<input value="Dam_Levee_Break" type="checkbox" name="boxes" onchange="checkbox()">	Dam/Levee Break
	</div>
	<div>
				<input value="Mud_Landslide" type="checkbox" name="boxes" onchange="checkbox()">	Mud/Landslide
	</div>
</div>

<div id='map'></div>



<script type="text/javascript">


drawMainMap = function(statesData) {

	var map = L.map('map').setView([37.8, -96], 4);

	L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
		maxZoom: 18,
		id: 'mapbox.light'
	}).addTo(map);



	var info = L.control();

	info.onAdd = function (map) {
		this._div = L.DomUtil.create('div', 'info');
		this.update();
		return this._div;
	};

	info.update = function (props) {

		this._div.innerHTML = '<h4>FEMA Disaster Database</h4>' +  (props ?
			'<b>' + props.name + '</b><br />' + props.density + ' disasters'
			: '');

	};

	info.addTo(map);



	function getColor(d) {
		return d > 1000 ? '#800026' :
				d > 500  ? '#BD0026' :
				d > 200  ? '#E31A1C' :
				d > 100  ? '#FC4E2A' :
				d > 50   ? '#FD8D3C' :
				d > 20   ? '#FEB24C' :
				d > 10   ? '#FED976' :
							'#FFEDA0';
	}

	function style(feature) {
		return {
			weight: 2,
			opacity: 1,
			color: 'white',
			dashArray: '3',
			fillOpacity: 0.7,
			fillColor: getColor(feature.properties.density)
		};
	}

	function highlightFeature(e) {
		var layer = e.target;

		layer.setStyle({
			weight: 5,
			color: '#666',
			dashArray: '',
			fillOpacity: 0.7
		});

		if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
			layer.bringToFront();
		}

		info.update(layer.feature.properties);
	}

	var geojson;

	function resetHighlight(e) {
		geojson.resetStyle(e.target);
		info.update();
	}

	function zoomToFeature(e) {
		map.fitBounds(e.target.getBounds());
	}

	function onEachFeature(feature, layer) {
		layer.on({
			mouseover: highlightFeature,
			mouseout: resetHighlight,
			click: zoomToFeature
		});
	}

	geojson = L.geoJson(statesData, {
		style: style,
		onEachFeature: onEachFeature
	}).addTo(map);

  return map

}


//ARBITRARILY CHOOSING TO DISPLAY TORNADOS AND VOLCANOS BY DEFAULT

var cboxes = document.getElementsByName('boxes');
var len = cboxes.length;

for (var i=0; i<len; i++) {

		if (cboxes[i].value == "Tornado")	{
			cboxes[i].checked = true;
		}

		else if (cboxes[i].value == "Volcano")	{
			cboxes[i].checked = true;
		}

}

var baseUrl = "{% url 'index' %}";

var selector = document.getElementById("end-year");
var output = document.getElementById("demo");
//output.innerHTML = selector.value;

// GET DEFAULT STATEDATA HERE

var statesData = {};

var currMap;

var updateStateData = function (disasters, endYear) {

	if (disasters == "")	{

		// USING AN END YEAR BEFORE THE EARLIEST YEAR IN
		// ORDER TO GET A CLEAN EMPTY RESPONSE.
		// SENDING EMPTY DISASTER STRING CREATES ISSUES.

		disasters = "Tornado";
		endYear = "1930";
	}

	var url = baseUrl + disasters + '/' + endYear + '/';
	fetch(url)
	.then(res => res.json())
	.then((out) => {
		statesData = out;
		if (currMap){
		currMap.remove();
	}
		currMap = drawMainMap(statesData);
	})
	.catch(err => { throw err });
}


//DRAW MAP ONCE WITH SOME ARBITRARY DISASTERS UP TO DATE
var disasters = 'Tornado+Volcano';
var endYear = '2018';
updateStateData(disasters, endYear);


// RETRIEVE STATE DATA AGAIN AND DRAW MAP AGAIN

selector.oninput = function() {
		endYear = this.value.toString()
    updateStateData(disasters, endYear);
}


var checkbox = function () {

		var cboxes = document.getElementsByName('boxes');
    var len = cboxes.length;
		var disasterList = [];
    for (var i=0; i<len; i++) {

				if (cboxes[i].checked)	{
					disasterList.push(cboxes[i].value);
				}

    }

			disasters = "";

			for(var i = 0; i < disasterList.length-1; i++)	{
				disasters = disasters + disasterList[i] + '+';
			}

			if (disasterList.length > 0)	{
				disasters = disasters + disasterList[disasterList.length-1];
			}

			console.log(disasters)

    	updateStateData(disasters, endYear);

}


</script>


</body>
</html>
